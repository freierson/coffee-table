---
title: "Table POC"
---


```{r}
library(tidyverse)
library(htmltools)
library(reactable)
library(reactablefmtr)
```


```{r}
table_data <- tibble(
  note = LETTERS[1:10],
  n = round(rnorm(n = 10, mean = 300)),
  a_prop = round(runif(min = 0, max = 1, n = 10), 2),
  b_prop = round(runif(min = 0, max = (1 - (a_prop)), n = 10), 2),
  c_prop = round(runif(min = 0, max = (1 - (a_prop + b_prop)), n = 10), 2),
  d_prop = round(runif(min = 0, max = (1 - (a_prop + b_prop + c_prop)), n = 10), 2),
  most_often = rep(paste0(letters[1:4], collapse = ",")),
  sentiment = round(rnorm(10), 2)
)
```

```{css}
.bean-header {
  width: 2em;
}

.bean-header-flag {
  font-size: 2em;
}

.bean-often {
  width: 1em;
}

.grouped-header {
  font-size: 2em;
}

.a_prop {
  filter: invert(94%) sepia(12%) saturate(520%) hue-rotate(331deg) brightness(90%) contrast(89%);
}

.b_prop {
  filter: invert(40%) sepia(4%) saturate(5059%) hue-rotate(330deg) brightness(90%) contrast(78%);
}

.c_prop {
  filter: invert(11%) sepia(15%) saturate(1762%) hue-rotate(324deg) brightness(94%) contrast(85%);
}

.d_prop {
  filter: invert(36%) sepia(54%) saturate(394%) hue-rotate(56deg) brightness(93%) contrast(90%);
}
.rt-text-content {
  width: 100%;
}
.bean-header-container {
  display: flex;
  flex-direction: row;
  justify-content: flex-end;
}
```

```{r}
bean_header <- JS("
  function(cellInfo, tableState) {
    return `<div class = 'bean-header-container'><span class = 'bean-header-flag'>${cellInfo.id == 'd_prop' ? 'ðŸ‡¨ðŸ‡´' : 'ðŸ‡°ðŸ‡ª'}</span><img src='https://www.svgrepo.com/show/493660/coffee-bean-filled-roast-brew.svg' class='bean-header ${cellInfo.id}' alt = 'coffee bean'/></div>`
  }
")
```


```{r}
bean_cell_bars <- data_bars(
  data = table_data,
  text_position = "above",
  tooltip = TRUE,
  fill_color = "#804A26"
)
```

```{r}
#| column: page
reactable(
  table_data,
  columns = list(
    note = colDef(name = "Notes in coffee"),
    n = colDef(name = "Occurences"),
    a_prop = colDef(
      header = bean_header, 
      cell = bean_cell_bars,
      html = TRUE),
    b_prop = colDef(
      header = bean_header,
      html = TRUE,
      cell = bean_cell_bars
    ),
    c_prop = colDef(
      header = bean_header,
      html = TRUE,
      cell = bean_cell_bars,
    ),
    d_prop = colDef(
      header = bean_header,
      html = TRUE,
      cell = bean_cell_bars,
    ),
    most_often = colDef(cell = JS("
      function(cellInfo, tableState) {
        console.log(cellInfo,'=====')

        console.log()

        return cellInfo.value.split(',').map(x => {
          return `<img src='https://www.svgrepo.com/show/493660/coffee-bean-filled-roast-brew.svg' class='bean-often ${x}_prop' alt = 'coffe bean'/>`
        }).join()
      }
    "), html = TRUE),
    sentiment = colDef(
      name = "",
      style = function(value) {
        color <- if (value > 0.5) {
          "#008000"
        } else if (value < -0.5) {
          "#e00000"
        } else {
          "#0a0a0a"
        }
        list(fontWeight = 600, color = color)
      }
    ))
  # ,
  # columnGroups = list(
  #   colGroup(
  #     name = "ðŸ‡°ðŸ‡ª",
  #     headerClass = "grouped-header",
  #     columns = c("a_prop", "b_prop", "c_prop")
  #   ),
  #   colGroup(
  #     name = "ðŸ‡¨ðŸ‡´",
  #     headerClass = "grouped-header",
  #     columns = "d_prop"
  #   )
  # )
)
```

